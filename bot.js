const Discord = require("discord.js")

const moment = require("moment")

const client = new Discord.Client();

const canvas = require("canvas");

const fs = require('fs')

const child_process = require("child_process");

const Rocket = new Discord.Client();

const jimp = require("jimp");// npm i jimp

const package = ('package.json');

const Util = require('discord.js');

const getYoutubeID = require('get-youtube-id');

const fetchVideoInfo = require('youtube-info');

const YouTube = require('simple-youtube-api');

const youtube = new YouTube("AIzaSyAdORXg7UZUo7sePv97JyoDqtQVi3Ll0b8");

const queue = new Map();

const ytdl = require('ytdl-core');

const dateFormat = require('dateformat');







const prefix = '$'

/////////

client.on('message', function(message) {
	const myID = "368768446327947265";
    let args = message.content.split(" ").slice(1).join(" ");
    if(message.content.startsWith(prefix + "sn")) {
		        if(message.author.id !== myID) return;
            if(!args) return message.reply('Ø§ÙƒØªØ¨ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù„ÙŠ ØªØ±ÙŠØ¯Ù‡Ø§.');
        client.user.setUsername(args);
        message.channel.send('**SetName,Done!**').then(msg => {
           msg.delete(5000);
          message.delete(5000);
        });
    } else if(message.content.startsWith(prefix + "s")) {
		        if(message.author.id !== myID) return;
            if(!args) return message.reply('Ø§ÙƒØªØ¨ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù„ÙŠ ØªØ±ÙŠØ¯Ù‡Ø§.');
        client.user.setGame(args , 'https://twitch.tv/6xlez1');
        message.channel.send('**Streaming,Done!ğŸ¶**').then(msg => {
           msg.delete(5000);
          message.delete(5000);
        });
    } else if(message.content.startsWith(prefix + "p")) {
				        if(message.author.id !== myID) return;
            if(!args) return message.reply('Ø§ÙƒØªØ¨ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù„ÙŠ ØªØ±ÙŠØ¯Ù‡Ø§.');
        client.user.setGame(args);
        message.channel.send('**Playing,Done!ğŸ¶**').then(msg => {
           msg.delete(5000);
          message.delete(5000);
        });
    } else if(message.content.startsWith(prefix + "l")) {
				        if(message.author.id !== myID) return;
            if(!args) return message.reply('Ø§ÙƒØªØ¨ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù„ÙŠ ØªØ±ÙŠØ¯Ù‡Ø§.');
        client.user.setActivity(args, {type:'LISTENING'});
        message.channel.send('**Listening,Done!ğŸ¶**').then(msg => {
           msg.delete(5000);
          message.delete(5000);
        });
    } else if(message.content.startsWith(prefix + "w")) {
				        if(message.author.id !== myID) return;
            if(!args) return message.reply('Ø§ÙƒØªØ¨ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù„ÙŠ ØªØ±ÙŠØ¯Ù‡Ø§.');
        client.user.setActivity(args, {type:'WATCHING'});
        message.channel.send('**Watching,Done!ğŸ¶**').then(msg => {
           msg.delete(5000);
          message.delete(5000);
        });
    } else if(message.content.startsWith(prefix + "setavatar")) {
				        if(message.author.id !== myID) return;
        client.user.setAvatar(args);
        message.channel.send(':white_check_mark: Done!').then(msg => {
                if(!args) return message.reply('Ø§ÙƒØªØ¨ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù„ÙŠ ØªØ±ÙŠØ¯Ù‡Ø§.');
           msg.delete(5000);
          message.delete(5000);
        });
    }
});

client.on('guildMemberAdd', member=> {



    client.channels.get("505300946096488451").send(`** # WÃ¨lÄomÃ¨ Å¤o MaÄ£ic..  **
    **# YourName.**: ${member} .`);

    });

var dat = JSON.parse("{}");
function forEachObject(obj, func) {
    Object.keys(obj).forEach(function (key) { func(key, obj[key]) })
}
client.on("ready", () => {
    var guild;
    while (!guild)
        guild = client.guilds.find("name", ", Magic Server.")
    guild.fetchInvites().then((data) => {
        data.forEach((Invite, key, map) => {
            var Inv = Invite.code;
            dat[Inv] = Invite.uses;
        })
    })
})
client.on("guildMemberAdd", (member) => {
    let channel = member.guild.channels.find('name', 'magic');
    if (!channel) {
        console.log("!channel fails");
        return;
    }
    if (member.id == client.user.id) {
        return;
    }
    console.log('made it till here!');
    var guild;
    while (!guild)
        guild = client.guilds.find("name", ", Magic Server.")
    guild.fetchInvites().then((data) => {
        data.forEach((Invite, key, map) => {
            var Inv = Invite.code;
            if (dat[Inv])
                if (dat[Inv] < Invite.uses) {
                    console.log(3);
                    console.log(`${member} joined over ${Invite.inviter}'s invite ${Invite.code}`)
 channel.send(`** Joined By : # ${Invite.inviter}   ** `)            
 }
            dat[Inv] = Invite.uses;
        })
    })
});

client.on("guildMemberAdd", member => {
  member.createDM().then(function (channel) {
  return channel.send(`**Welcome To MaÄ£ic**.'
   ${member}`) 
}).catch(console.error)
})



var ss = 0;
 
client.on('voiceStateUpdate', (o,n) => {
    if (o.voiceChannel && !n.voiceChannel) {
        ss-=1
        n.guild.channels.get("505616173094666280").edit({
            name : "# MaÄ£ic Online. : [" + ss+ "]"
        })
    };
    if (n.voiceChannel && !o.voiceChannel) {
        ss+=1
        n.guild.channels.get("505616173094666280").edit({
            name : "# MaÄ£ic Online. : [" + ss+ "]"
        })
    }
})
client.on("ready", () => {
    client.guilds.get("505286693532729345").members.forEach(m => {
        if (m.voiceChannel) {
            ss+=1
        };
        client.channels.get("505616173094666280").edit({
            name : "# MaÄ£ic Online. : [" + ss+ "]"
        })
    });
 
});

	client.on('message', message => {



if (message.author.bot) return;

  if (message.content.split(" ")[0].toLowerCase() === prefix + "Ù‚ÙÙ„") {

                        if(!message.channel.guild) return;



if(!message.member.hasPermission('MANAGE_MESSAGES')) return message.reply('You Need MANAGE_MESSAGES Permission').then(message => message.delete(5000))

           message.channel.overwritePermissions(message.guild.id, {

         SEND_MESSAGES: false



           }).then(() => {

 const e = new Discord.RichEmbed()

               .setAuthor('Channel Disabled By : '+message.author.username)

                .setColor('#36393e')

               

               message.channel.send(e)

               });

             }

if (message.content.split(" ")[0].toLowerCase() === prefix + "ÙØªØ­") {

    if(!message.channel.guild) return;



if(!message.member.hasPermission('MANAGE_MESSAGES')) return message.reply('You Need MANAGE_MESSAGES Permission').then(message => message.delete(5000))

           message.channel.overwritePermissions(message.guild.id, {

         SEND_MESSAGES: true



           }).then(() => {

               const e = new Discord.RichEmbed()

               .setAuthor('Channel Enabled By : '+message.author.username)

                        .setColor('#36393e')

               

               message.channel.send(e)

           });

             }







});

  client.on('message', message => {

    if(message.content.includes('discord.gg')){

                                            if(!message.channel.guild) return message.reply('**- :chocolate_bar: #WÃ¨lÄomÃ¨ Å¤o Our.:microphone:.**');

        if (!message.member.hasPermissions(['ADMINISTRATOR'])){

        message.delete()

    return message.reply(`**Ù…Ù…Ù€Ù†ÙˆØ¹ Ø¢Ù„Ù€Ù†Ø´Ø± Ù‡Ù€Ù†Ø¢ .. Ø±ÙˆØ¢Ø¨Ù€Ø· Ø¯ÙŠØ³ÙƒÙ€ÙˆØ±Ø¯.**`)

    }

}

});


  client.on('message', message => {

    if(message.content.includes('youtube')){

                                            if(!message.channel.guild) return message.reply('**- :chocolate_bar: #WÃ¨lÄomÃ¨ Å¤o Our.:microphone:.**');

        if (!message.member.hasPermissions(['ADMINISTRATOR'])){

        message.delete()

    return message.reply(`**Ù…Ù…Ù€Ù†ÙˆØ¹ Ø¢Ù„Ù€Ù†Ø´Ø± Ù‡Ù€Ù†Ø¢ .. Ø±ÙˆØ¢Ø¨Ù€Ø· ÙŠÙˆØªÙŠÙˆØ¨.**`)

    }

}

});

client.on('message',async message => {
  if(message.content.startsWith(prefix + "bcall")) {
if(message.member.hasPermissions(['ADMINISTRATOR'])) {
    let filter = m => m.author.id === message.author.id;
    let thisMessage;
    let thisFalse;
    message.channel.send('ğŸ‡§ğŸ‡¨| **Ø§Ø±Ø³Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ù†**').then(msg => {

    let awaitM = message.channel.awaitMessages(filter, {
      max: 1,
      time: 20000,
      errors: ['time']
    })
    .then(collected => {
      collected.first().delete();
      thisMessage = collected.first().content;
      msg.edit('ğŸ‡§ğŸ‡¨| **Ù‡Ù„ Ø§Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ**');
      let awaitY = message.channel.awaitMessages(response => response.content === 'Ù†Ø¹Ù…' || 'Ù„Ø§' && filter,{
        max: 1,
        time: 20000,
        errors: ['time']
      })
      .then(collected => {
        if(collected.first().content === 'Ù„Ø§') {
          msg.delete();
          message.delete();
          thisFalse = false;
        }
        if(collected.first().content === 'Ù†Ø¹Ù…') {
          if(thisFalse === false) return;
        message.guild.members.forEach(member => {
          msg.edit('ğŸ‡§ğŸ‡¨| **Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø±Ø³Ø§Ù„**');
          collected.first().delete();
          member.send(`${thisMessage}\n\n${member} ,\nØªÙ… Ø§Ù„Ø§Ø±Ø³Ø§Ù„ Ù…Ù† : ${message.guild.name}\n ØªÙ… Ø§Ù„Ø§Ø±Ø³Ø§Ù„ Ø¨ÙˆØ§Ø³Ø·Ø© : ${message.author.tag}`);
        });
        }
      });
    });
    });
} else return message.reply('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª')
  }
});

client.on('message', message => {

 if (message.content.startsWith('Mb')) {

  var norElden= new Discord.RichEmbed()

  .addField('Ø§Ø³Ù… Ø§Ù„Ø³ÙŠØ±ÙØ± ',` **__${message.guild.name}__**`)

      .addField('Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø¹Ø¶Ø§Ø¡',`**__${message.guild.memberCount}__**`)

  .setColor('RANDOM')

message.channel.send({ embed: norElden });

  }

});

 client.on('message', message => {
    if(message.content.startsWith(prefix + 'moveall')) {
     if (!message.member.hasPermission("MOVE_MEMBERS")) return message.channel.send('**Ù„Ø§ÙŠÙˆØ¬Ø¯ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø³Ø­Ø¨ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡**');
       if(!message.guild.member(client.user).hasPermission("MOVE_MEMBERS")) return message.reply("**Ù„Ø§ÙŠÙˆØ¬Ø¯ Ù„Ø¯ÙŠ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø³Ø­Ø¨**");
    if (message.member.voiceChannel == null) return message.channel.send(`**Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø±ÙˆÙ… ØµÙˆØªÙŠ**`)
     var author = message.member.voiceChannelID;
     var m = message.guild.members.filter(m=>m.voiceChannel)
     message.guild.members.filter(m=>m.voiceChannel).forEach(m => {
     m.setVoiceChannel(author)
     })
     message.channel.send(`**ØªÙ… Ø³Ø­Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„ÙŠ Ø§Ù„Ø±ÙˆÙ… Ø§Ù„ØµÙˆØªÙŠ Ø­Ù‚Ùƒ.**`)


     }
       });

    client.on('message', message => {
if(!message.channel.guild) return;
if(message.content.startsWith(prefix + 'move')) {
        if(!message.member.hasPermission("MOVE_MEMBERS")) return message.channel.send("âš ï¸|`Ø§Ù†Øª Ù„Ø§ ØªÙ…ØªÙ„Ùƒ Ø§Ù„Ø®Ø§ØµÙŠÙ‡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©`");  
 if (message.member.hasPermission("MOVE_MEMBERS")) {
 if (message.mentions.users.size === 0) {
 return message.channel.send("``Ù„Ù„Ø£Ø³ØªØ®Ø¯Ø§Ù… Ø§ÙƒØªØ¨  : " +prefix+ "move [USER]``")
}
if (message.member.voiceChannel != null) {
 if (message.mentions.members.first().voiceChannel != null) {
 var authorchannel = message.member.voiceChannelID;
 var usermentioned = message.mentions.members.first().id;
var embed = new Discord.RichEmbed()
 .setTitle("Succes!")
 .setColor("#000000")
 .setDescription(`Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø³Ø­Ø¨ <@${usermentioned}> Ø§Ù„Ù‰ Ø§Ù„Ø±ÙˆÙ… Ø§Ù„ØµÙˆØªÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒâœ… `)
var embed = new Discord.RichEmbed()
.setTitle(`You are Moved in ${message.guild.name}`)
 .setColor("RANDOM")
.setDescription(`**<@${message.author.id}> Moved You To His Channel!\nServer --> ${message.guild.name}**`)
 message.guild.members.get(usermentioned).setVoiceChannel(authorchannel).then(m => message.channel.send(embed))
message.guild.members.get(usermentioned).send(embed)
} else {
message.channel.send("`Ù„Ø§ ØªØ³ØªØ·ÙŠØ¹ Ø³Ø­Ø¨ `"+ message.mentions.members.first() +" `ÙŠØ¬Ø¨ Ø§Ù† ÙŠÙƒÙˆÙ† Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ø¶Ùˆ ÙÙŠ Ø±ÙˆÙ… ØµÙˆØªÙŠ`")
}
} else {
 message.channel.send("**``ÙŠØ¬Ø¨ Ø§Ù† ØªÙƒÙˆÙ† ÙÙŠ Ø±ÙˆÙ… ØµÙˆØªÙŠ Ù„ÙƒÙŠ ØªÙ‚ÙˆÙ… Ø¨Ø³Ø­Ø¨ Ø§Ù„Ø¹Ø¶Ùˆ Ø£Ù„ÙŠÙƒ``**")
}
} else {
message.react("âŒ")
 }
}
});

const adminprefix = "$";
const devs = ['368768446327947265'];

client.on('message', message => {
if(message.content === adminprefix + "restart") {
      if (!devs.includes(message.author.id)) return;
          message.channel.send(` Restarting : ${message.author.username}`);
        console.log(`âš ï¸ Ø¬Ø§Ø±ÙŠ Ø§Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª... âš ï¸`);
        client.destroy();
        child_process.fork(__dirname + "/bot.js");
        console.log(`ØªÙ… Ø§Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª`);
    }
  
  });

client.on('message', message => { 
           if (message.content.startsWith(prefix + "id")) {
     var args = message.content.split(" ").slice(1);
     let user = message.mentions.users.first();
     var men = message.mentions.users.first();
        var heg;
        if(men) {
            heg = men
        } else {
            heg = message.author
        }
      var mentionned = message.mentions.members.first();
         var h;
        if(mentionned) {
            h = mentionned
        } else {
            h = message.member
        }
               moment.locale('ar-TN');
      var id = new  Discord.RichEmbed()
      .setAuthor(message.author.username, message.author.avatarURL) 
    .setColor("#707070")
    .addField(': Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯ Ù‚Ø¨Ù„', `${moment(heg.createdTimestamp).format('YYYY/M/D HH:mm:ss')} **\n** \`${moment(heg.createdTimestamp).fromNow()}\`` ,true) 
    .addField(': Ø§Ù†Ø¶Ù…Ø§Ù…Ùƒ Ù„Ø³ÙŠØ±ÙØ± Ù‚Ø¨Ù„', `${moment(h.joinedAt).format('YYYY/M/D HH:mm:ss')} \n \`${moment(h.joinedAt).fromNow()}\``, true)               
    .setFooter(`OurBot.`, 'https://images-ext-2.discordapp.net/external/JpyzxW2wMRG2874gSTdNTpC_q9AHl8x8V4SMmtRtlVk/https/orcid.org/sites/default/files/files/ID_symbol_B-W_128x128.gif')                                 
    .setThumbnail(heg.avatarURL);
    message.channel.send(id)
}       });

client.on('ready', () => {
  console.log(`Logged in as ${client.user.tag}!`);
});
/*Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ù‡Ù‡ Ù„Ø±ÙŠØ¨Ù„ ÙˆÙ„Ø³ÙŠØ±ÙØ± ÙƒÙˆØ¯Ø²
Ø±Ø¢Ø­ ÙŠØ±Ø³Ù„ Ù„Ù„Ø£ÙˆÙ†Ø± ØªØ­Ø°ÙŠØ± + Ù… ÙŠØªØ·Ù„Ø¨ Ù…Ù„ÙØ§Øª Ø³ÙˆÙŠØªÙ‡ Ù„ÙƒÙ… Ø¯Ø§ØªØ§ Ù…Ø¤Ù‚Øª
Ø³Ùˆ Ø±ÙˆÙ… Ø¨Ø£Ø³Ù… log 
Ø£Ùˆ ØºÙŠØ±Ù‡ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø¹Ø´Ø§Ù† ÙŠØ±Ø³Ù„ Ù‡Ù†Ø§ Ø§Ù„ØªØ­Ø°ÙŠØ±
nvm i 10 
nvm use 10
npm i discord.js
*/
var guilds = {};
client.on('guildBanAdd', function(guild) {
            const rebellog = client.channels.find("name", "log"),
            Onumber = 3,
  Otime = 10000
guild.fetchAuditLogs({
    type: 22
}).then(audit => {
    let banner = audit.entries.map(banner => banner.executor.id)
    let bans = guilds[guild.id + banner].bans || 0 
    guilds[guild.id + banner] = {
        bans: 0
    }
      bans[guilds.id].bans += 1; 
if(guilds[guild.id + banner].bans >= Onumber) {
try {
let roles = guild.members.get(banner).roles.array();
guild.members.get(banner).removeRoles(roles);
  guild.guild.member(banner).kick();

} catch (error) {
console.log(error)
try {
guild.members.get(banner).ban();
  rebellog.send(`<@!${banner.id}>
Ø­Ø¢ÙˆÙ„ Ø§Ù„Ø¹Ø¨Ø« Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± @everyone`);
guild.owner.send(`<@!${banner.id}>
Ø­Ø¢ÙˆÙ„ Ø§Ù„Ø¹Ø¨Ø« Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± ${guild.name}`)
    setTimeout(() => {
 guilds[guild.id].bans = 0;
  },Otime)
} catch (error) {
console.log(error)
}
}
}
})
});
 let channelc = {};
  client.on('channelCreate', async (channel) => {
  const rebellog = client.channels.find("name", "log"),
  Oguild = channel.guild,
  Onumber = 3,
  Otime = 10000;
  const audit = await channel.guild.fetchAuditLogs({limit: 1});
  const channelcreate = audit.entries.first().executor;
  console.log(` A ${channel.type} Channel called ${channel.name} was Created By ${channelcreate.tag}`);
   if(!channelc[channelcreate.id]) {
    channelc[channelcreate.id] = {
    created : 0
     }
 }
 channelc[channelcreate.id].created += 1;
 if(channelc[channelcreate.id].created >= Onumber ) {
    Oguild.members.get(channelcreate.id).kick();
rebellog.send(`<@!${channelcreate.id}>
Ø­Ø¢ÙˆÙ„ Ø§Ù„Ø¹Ø¨Ø« Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± @everyone`);
channel.guild.owner.send(`<@!${channelcreate.id}>
Ø­Ø¢ÙˆÙ„ Ø§Ù„Ø¹Ø¨Ø« Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± ${channel.guild.name}`)
}
  setTimeout(() => {
 channelc[channelcreate.id].created = 0;
  },Otime)
  });

let channelr = {};
  client.on('channelDelete', async (channel) => {
  const rebellog = client.channels.find("name", "log"),
  Oguild = channel.guild,
  Onumber = 3,
  Otime = 10000;
  const audit = await channel.guild.fetchAuditLogs({limit: 1});
  const channelremover = audit.entries.first().executor;
  console.log(` A ${channel.type} Channel called ${channel.name} was deleted By ${channelremover.tag}`);
   if(!channelr[channelremover.id]) {
    channelr[channelremover.id] = {
    deleted : 0
     }
 }
 channelr[channelremover.id].deleted += 1;
 if(channelr[channelremover.id].deleted >= Onumber ) {
  Oguild.guild.member(channelremover).kick();
rebellog.send(`<@!${channelremover.id}>
Ø­Ø¢ÙˆÙ„ Ø§Ù„Ø¹Ø¨Ø« Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± @everyone`);
channel.guild.owner.send(`<@!${channelremover.id}>
Ø­Ø¢ÙˆÙ„ Ø§Ù„Ø¹Ø¨Ø« Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± ${channel.guild.name}`)
}
  setTimeout(() => {
 channelr[channelremover.id].deleted = 0;
  },Otime)
  });
  

client.login(process.env.BOT_TOKEN); 
